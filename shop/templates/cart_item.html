<!DOCTYPE html>
<html lang='pl'>
<head>
    <meta charset="UTF-8">
    <title>Koszyk</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/list_style.css' %}">
    <link rel="stylesheet" href="{% static 'css/form_style.css' %}">
</head>
<body>
{% include 'login_logout_links.html' %}

<h1 class="date-corner">Dzisiaj {{ current_date }}</h1>
<div class="home-link">
    <a href="{% url 'home' %}">
        <img src="{% static 'images/home.jpg' %}" alt="STRONA GŁÓWNA" class="home-icon">
    </a>
</div>


<div class="honey-table-container">
    <h2 style="margin-bottom: 18px; text-align: center;">KOSZYK</h2>

    {% if user.is_authenticated and items %}
        <div class="product-grid">
            {% for item in items %}
                <div class="product-card cart-card">
                    <div class="product-image">
                        {% if item.product %}
                            <img src="{% static 'images/bee_product.webp' %}" alt="{{ item.product }}">
                        {% elif item.honey %}
                            <img src="{% static 'images/honey.jpg' %}" alt="{{ item.honey }}">
                        {% endif %}
                    </div>
                    <div class="product-details">
                        <h3>
                            {% if item.product %}
                                {{ item.product }}
                            {% elif item.honey %}
                                {{ item.honey }}
                            {% endif %}
                        </h3>
                        <div class="cart-qty-row">
                            <b>Ilość:</b>
                            <form method="post" action="{% url 'update_cart_item_quantity' item.id %}" class="cart-qty-form">
                                {% csrf_token %}
                                <input type="number"
                                       name="quantity"
                                       value="{{ item.quantity }}"
                                       min="0"
                                       max="{{ item.available_quantity }}"
                                       required>
                                <button type="submit">Zmień</button>
                            </form>
                        </div>
                        <div class="product-price" style="margin-top:8px;">
                            Cena:
                            {% if item.product %}
                                {{ item.product.price }} PLN
                            {% elif item.honey %}
                                {{ item.honey.price }} PLN
                            {% endif %}
                        </div>
                        <div class="cart-total">
                            Łącznie: {{ item.total }} PLN
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
        <div class="cart-summary">
            <div class="sum-label">Łącznie w koszyku:</div>
            <div class="sum-value">{{ total_cart }} PLN</div>
            <a href="{% url 'order_summary' %}" class="btn-link2">PODSUMOWANIE ZAMÓWIENIA</a>
        </div>
    {% else %}
        <div class="cart-empty-info">
            <strong>Brak produktów w koszyku.</strong><br>
            <strong>Zaloguj się, aby móc zrobić zakupy.</strong>
        </div>
    {% endif %}

    <div class="cart-back-btn">
        <a href="{% url 'shop_products' %}" class="btn-link3">POWRÓT DO SKLEPU</a>
    </div>

    {% if message %}
        <div class="center-message">
            <div class="message-box {{ message.tags }}">
                <div class="message-text">
                    {{ message }}
                </div>
                <div class="message-actions">
                    <a href="{% url 'cart' %}" class="action-btn">OK</a>
                </div>
            </div>
        </div>
    {% endif %}
</div>
</body>
</html>